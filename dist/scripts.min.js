const e = (function () {
  let e = [],
    t = "https://pokeapi.co/api/v2/pokemon/?limit=150";
  function n(t) {
    "object" == typeof t && "name" in t
      ? e.push(t)
      : console.log("Pokemon is not correct");
  }
  function o() {
    let e = document.createElement("p");
    (e.innerText = "Loading..."), document.body.appendChild(e);
  }
  function i() {
    let e = document.querySelector("p");
    e && e.remove();
  }
  function l(e) {
    o();
    let t = e.detailsUrl;
    return fetch(t)
      .then(function (e) {
        return i(), e.json();
      })
      .then(function (t) {
        (e.imageUrl = t.sprites.front_default),
          (e.height = t.height),
          (e.types = t.types);
      })
      .catch(function (e) {
        i(), console.error(e);
      });
  }
  function c(e) {
    l(e).then(function () {
      !(function (e, t, n) {
        document.querySelector(".modal-title").innerText = e;
        let o = document.querySelector("#exampleModal .modal-body");
        o.innerHTML = "";
        let i = document.createElement("p");
        i.innerText = "" + t;
        let l = document.createElement("img");
        l.classList.add("modal-image"),
          (l.src = n),
          (l.alt = "Pokemon Image"),
          o.appendChild(i),
          o.appendChild(l),
          new bootstrap.Modal(document.getElementById("exampleModal")).show();
      })(e.name, "Height: " + e.height, e.imageUrl);
    });
  }
  function d() {
    document.querySelector("#modal-container").classList.remove("is-visible");
  }
  window.addEventListener("keydown", function (e) {
    let t = document.querySelector("#modal-container");
    "Escape" === e.key && t.classList.contains("is-visible") && d();
  });
  let a = document.querySelector("#modal-container");
  return (
    a.addEventListener("click", function (e) {
      e.target === a && d();
    }),
    {
      getAll: function () {
        return e;
      },
      add: n,
      addListItem: function (e) {
        let t = document.querySelector(".pokemon-list"),
          n = document.createElement("div");
        n.classList.add("col-md-4", "mb-4");
        let o = document.createElement("div");
        o.classList.add("card");
        let i = document.createElement("div");
        i.classList.add("card-body");
        let l = document.createElement("h5");
        l.classList.add("card-title"), (l.innerText = e.name);
        let d = document.createElement("button");
        d.classList.add("btn", "btn-info"),
          (d.innerText = "Details"),
          d.setAttribute("data-toggle", "modal"),
          d.setAttribute("data-target", "#exampleModal"),
          d.addEventListener("click", function (t) {
            c(e);
          }),
          i.appendChild(l),
          i.appendChild(d),
          o.appendChild(i),
          n.appendChild(o),
          t.appendChild(n);
      },
      loadList: function () {
        return (
          o(),
          fetch(t)
            .then(function (e) {
              return i(), e.json();
            })
            .then(function (e) {
              e.results.forEach(function (e) {
                n({ name: e.name, detailsUrl: e.url });
              });
            })
            .catch(function (e) {
              i(), console.error(e);
            })
        );
      },
      loadDetails: l,
      showDetails: c,
    }
  );
})();
let t = document.createElement("div");
t.classList.add("pokemon-list"),
  document.body.appendChild(t),
  e.loadList().then(function () {
    e.getAll().forEach(function (t) {
      e.addListItem(t);
    });
  });
